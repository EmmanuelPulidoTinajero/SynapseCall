<div class="meeting-container" style="display: flex; height: 100vh; overflow: hidden; background: #202124;">
    
    <div class="main-area" style="flex: 1; display: flex; flex-direction: column; position: relative;">
        
        <div class="top-bar" style="background: rgba(0,0,0,0.6); color: white; padding: 10px; display: flex; justify-content: space-between; align-items: center; position: absolute; top: 0; left: 0; right: 0; z-index: 10;">
            
            <div class="branding" style="display: flex; align-items: center; gap: 10px;">
                {{#if orgLogo}}
                    <img src="{{orgLogo}}" alt="Org" style="height: 30px; border-radius: 4px;">
                {{/if}}
                {{#if orgName}}
                    <span style="font-weight: bold; font-size: 0.9rem;">{{orgName}}</span>
                    <span style="margin: 0 5px;">|</span>
                {{/if}}
                <span>{{meetingTitle}}</span>
            </div>

            <div id="active-agenda-display" style="display: none; background: #333; padding: 5px 15px; border-radius: 20px; border: 1px solid #555;">
                <span id="current-topic" style="font-weight: bold; color: #4dabf7;">Tema Actual</span>
                <span style="margin: 0 5px;">-</span>
                <span id="timer-countdown" style="font-family: monospace; font-size: 1.1rem; font-weight: bold;">00:00</span>
            </div>

            <div class="controls">
                {{#if isPro}}
                    <button id="toggle-agenda-btn" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">üìÖ Agenda</button>
                {{/if}}
            </div>
        </div>

        <div id="video-grid" style="flex: 1; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 10px; padding: 60px 10px 10px 10px; overflow-y: auto;"></div>
        
        <div class="bottom-controls" style="background: #333; padding: 15px; display: flex; justify-content: center; gap: 20px;">
            <button id="mute-btn" class="control-btn">üéôÔ∏è Mute</button>
            <button id="video-btn" class="control-btn">üìπ Video</button>
            <button class="control-btn" style="background: #dc3545;" onclick="window.location.href='/'">üìû Salir</button>
        </div>
    </div>

    <div id="side-panel" style="width: 350px; background: white; border-left: 1px solid #ccc; display: flex; flex-direction: column;">
        
        <div class="tabs" style="display: flex; border-bottom: 1px solid #ddd;">
            <button class="tab-btn active" onclick="showTab('chat')" style="flex: 1; padding: 10px; border: none; background: #f0f0f0; cursor: pointer;">Chat</button>
            {{#if isPro}}
                <button class="tab-btn" onclick="showTab('agenda')" style="flex: 1; padding: 10px; border: none; background: white; cursor: pointer;">Agenda</button>
            {{/if}}
        </div>

        <div id="chat-tab" class="tab-content" style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
            <div id="chat-messages" style="flex: 1; overflow-y: auto; padding: 10px;"></div>
            <form id="chat-form" style="padding: 10px; border-top: 1px solid #eee; display: flex;">
                <input id="chat-input" type="text" placeholder="Escribe..." style="flex: 1; padding: 8px;">
                <button type="submit" style="margin-left: 5px; padding: 5px 10px;">Enviar</button>
            </form>
            <form id="file-upload-form" action="/meetings/{{meetingId}}/uploadFiles" method="post" enctype="multipart/form-data" style="padding: 5px 10px; background: #f9f9f9;">
                <input type="file" name="file" id="file-input" style="font-size: 0.8rem;">
                <button type="submit" id="upload-button" style="font-size: 0.8rem;">Subir</button>
            </form>
        </div>

        {{#if isPro}}
        <div id="agenda-tab" class="tab-content" style="display: none; flex: 1; flex-direction: column; padding: 10px; overflow-y: auto;">
            <h3>Agenda de Reuni√≥n</h3>
            
            <div id="agenda-list" style="flex: 1; overflow-y: auto; margin-bottom: 10px;">
                <p style="color: #999; text-align: center;">Cargando agenda...</p>
            </div>

            {{#if isHost}}
            <div class="host-controls" style="border-top: 1px solid #eee; padding-top: 10px;">
                <h4>Controles de Host</h4>
                <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                    <button id="btn-start-agenda" style="flex: 1; background: #28a745; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">‚ñ∂ Iniciar</button>
                    <button id="btn-next-item" style="flex: 1; background: #007bff; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">‚è≠ Siguiente</button>
                </div>
                
                <form id="add-agenda-form" style="display: flex; gap: 5px; flex-wrap: wrap;">
                    <input type="text" id="new-topic" placeholder="Nuevo tema" style="flex: 2; padding: 5px;">
                    <input type="number" id="new-duration" placeholder="Min" style="width: 50px; padding: 5px;">
                    <button type="submit" style="background: #6c757d; color: white; border: none; padding: 5px 10px;">+</button>
                </form>
            </div>
            {{/if}}
        </div>
        {{/if}}

    </div>
</div>

<script>
    const MEETING_ID = "{{meetingId}}";
    const IS_HOST = {{isHost}};
    const IS_PRO = {{isPro}};
    const ICE_SERVERS = {{{iceServersJson}}};
    // Variables para l√≥gica de frontend
    let currentAgendaItem = null;
    let agendaItems = [];

    // Funci√≥n para cambiar tabs
    function showTab(tabName) {
        document.getElementById('chat-tab').style.display = tabName === 'chat' ? 'flex' : 'none';
        if(document.getElementById('agenda-tab')) {
            document.getElementById('agenda-tab').style.display = tabName === 'agenda' ? 'flex' : 'none';
        }
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.style.background = btn.textContent.toLowerCase().includes(tabName) ? '#f0f0f0' : 'white';
        });
    }

    // Toggle panel
    document.getElementById('toggle-agenda-btn')?.addEventListener('click', () => {
        const panel = document.getElementById('side-panel');
        panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
    });
</script>